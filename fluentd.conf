<source>
  @type tail
  path C:/authnull-agent/endpoint-agent.log
  pos_file C:/authnull-agent/endpoint-agent.log.pos
  tag windowsagent.log
  <parse>
    @type apache
  </parse>
</source>

<filter your_tag_name>
  @type grep
  <regexp>
    key message
    pattern /Payload/
  </regexp>
</filter>

<filter get_public_ip>
  @type record_transformer
  enable_ruby
  <record>
    publicIP ${Socket.ip_address_list.detect { |addr| addr.ipv4_private? }.ip_address}
  </record>
</filter>


<match windowsagent.log>
  @type http
  endpoint https://v1.api.authnull.com/api/v1/log/endpoint/logit
  <format>
    @type json
  </format>
  
  <inject>
    orgId ${record["message"].match(/\"orgId\":(\d+)/)[1]}
    domainId ${record["message"].match(/\"domainId\":(\d+)/)[1]}
    publicIP ${record["publicIP"]}
    message ${record["message"]}
    component windows-agent
  </inject>
</match>


