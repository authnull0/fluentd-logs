<source>
  @type windows_eventlog2
  tag ad_logs
  channels security
  parse_description true
  <storage>
    @type local
    persistent true
    path C:\opt\fluent\etc\fluent\winevt.pos
  </storage>
</source>
<filter ad_logs>
  
	@type grep
 

 <regexp>
    
	key DescriptionTitle
    
	pattern /An account was successfully logged on.|An account failed to log on./
	 
 </regexp>


<regexp>
    
	key subject.account_domain   
	pattern AUTHULL3
 </regexp>



</filter>

<filter ad_logs>
  
@type grep
 
 <exclude>
   
 	key network_information.source_network_address
    
	pattern /^$/
  
</exclude>

</filter>

<filter ad_logs>
  
	@type record_transformer
	enable_ruby
	
  
<record>
	orgId "84"
	tenantId "7"
    	username ${record["account_for_which_logon_failed.account_name"] || record["new_logon.account_name"]}
	domain ${record["subject.account_domain"]}
	logDescription ${record["DescriptionTitle"]}
	sourceIp ${record["network_information.source_network_address"]}
	IP 172.212.108.129
    	component ad-auth
  
</record>

</filter>

<match ad_logs>
  @type http
endpoint https://prod.api.authnull.com/api/v1/log/endpoint/logit
  http_method post
  serializer json
  <buffer>
    @type file
    path /var/log/fluentd/buffer
    flush_mode immediate
  </buffer>
</match>
